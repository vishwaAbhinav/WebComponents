<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Web Components - complex filter</title>
    <template id="complexFilterTemplate">
        <style>
            .outer {
                border: 2px solid brown;
                background: navajowhite;
                font-size: 12pt;
                width: 12em;
                height: 8em;
            }
            .checkbox-div {
                height: 5em;
                overflow: auto;
            }
        </style>
        <div class="outer">
            <div class="title">
                <content select=".title-holder"></content>
            </div>
            <div class="checkbox-div"><content select=".checkbox-holder"></content></div>
            <input class="auto-complete-input" placeholder="Search in " type="text"/>
        </div>
    </template>
</head>
<body>
    <script src="lib/webcomponents.js"></script>
    <script>
        "use strict";

        if(document.currentScript && document.currentScript != null) {
            var importDoc = document.currentScript.ownerDocument;
        }
        else {
            var importDoc = document._currentScript.ownerDocument;
        }

        var proto = Object.create(HTMLElement.prototype);

        Object.defineProperty(proto, "header", { 
            headerLabel : "",
            get : function() {return this.headerLabel},
            set : function(headerLabel) {this.headerLabel = headerLabel}
        });

        proto.getHeader = function() {
            return this.header;
        }

        proto.setHeader = function(headerLabel) {
            this.header = headerLabel;

            var header = document.createElement("label");
            header.innerHTML = headerLabel;
            header.setAttribute("class", "title-holder");
            this.appendChild(header);

            this.shadowRoot.querySelector(".auto-complete-input").placeholder = "Search in " + headerLabel;
        }

        proto.getUniverse = function() {
            return this.listElements;
        }

        Object.defineProperty(proto, "listElements", { 
            elements : [],
            get : function() {return this.elements},
            set : function(listElements) {this.elements = listElements}
        });

        proto.setUniverse = function(listElements) {
            console.log("Universe is being set for " + this.getElementsByClassName("title-holder")[0].innerHTML + " with list : " + listElements);

            var checkboxHolder = document.createElement("div");
            checkboxHolder.setAttribute("class","checkbox-holder")

            this.listElements = listElements;
            for(var i in listElements) {
                var tmpDiv = document.createElement("div");
                tmpDiv.style.display = "block";
                tmpDiv.style.marginLeft = "80px";
                var tmpCheck = document.createElement("input");
                tmpCheck.setAttribute("type", "checkbox");
                tmpCheck.setAttribute("onChange", "filterListChanged(this)");
                tmpDiv.appendChild(tmpCheck);
                tmpDiv.appendChild(document.createTextNode(listElements[i]));
                checkboxHolder.appendChild(tmpDiv);
            }
            this.appendChild(checkboxHolder);
        };

        proto.createdCallback = function() {
            var root = this.createShadowRoot();
            var template = document.querySelector("#complexFilterTemplate");
            if(!template) {
                template = importDoc.querySelector("#complexFilterTemplate");
            }

            var checkboxHolder = this.querySelector("ul");
            var listElements = [];
            if(checkboxHolder) {
                var listItems = checkboxHolder.getElementsByTagName("li");
                for (var i = 0; i < listItems.length; i++) {
                   listElements.push(listItems[i].innerHTML);
                }
                this.setUniverse(listElements);
            }

            var headerLabel = this.querySelector(".title-holder");
            if(headerLabel) {
                this.header = headerLabel.innerHTML;
            }

            var clone = document.importNode(template.content, true);

            if(this.header) {
                clone.querySelector(".auto-complete-input").placeholder = "Search in " + this.header;
            }

            root.appendChild(clone);
        };

        var ComplexFilter = document.registerElement("complex-filter",{
          prototype : proto
        });

        function filterListChanged(element) {
            console.log(element.parentElement.innerText + " selected");
        }
    </script>
</body>
</html>